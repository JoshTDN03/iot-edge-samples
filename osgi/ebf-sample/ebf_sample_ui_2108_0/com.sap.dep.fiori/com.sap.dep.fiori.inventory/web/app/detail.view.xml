<mvc:View
    controllerName="dep.fiori.inventory.app.detail"
    class="dep-fiori"
    displayBlock="true"
    height="100%"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:c="sap.ui.core"
    xmlns:u="sap.uxap"
    xmlns:l="sap.ui.layout"
    xmlns="sap.m">
    <Page
        showHeader="false"
        showSubHeader="false"
        enableScrolling="false">
        <u:ObjectPageLayout
            id="content"
            alwaysShowContentHeader="true"
            useIconTabBar="true"
            navigate="onPageNav">

            <u:headerTitle>
                <u:ObjectPageHeader objectTitle="{i18n>Detail.title} {/0/IBLNR} ({/0/INV_NO_LOCAL})" />
            </u:headerTitle>

            <u:headerContent>
                <VBox renderType="Bare">
                    <HBox renderType="Bare">
                        <Label
                            text="{i18nGlobal>General.location}:"
                            class="sapUiTinyMarginEnd" />
                        <Label text="{/0/LGORT}" />
                    </HBox>
                    <HBox
                        renderType="Bare"
                        visible="{approvedBy>/approved}">
                        <Label
                            text="{i18n>Review.approvedBy}:"
                            design="Bold"
                            class="sapUiTinyMarginEnd" />
                        <Label
                            text="{approvedBy>/plantuser}"
                            design="Bold" />
                    </HBox>
                </VBox>
            </u:headerContent>

            <u:sections>
                <u:ObjectPageSection
                    id="detail"
                    title="{i18n>Page.count}">
                    <u:subSections>
                        <u:ObjectPageSubSection>
                            <u:blocks>
                                <Table
                                    noDataText="{i18n>List.empty}"
                                    growing="true"
                                    items="{/}"
                                    growingScrollToLoad="true">
                                    <headerToolbar>
                                        <Toolbar>
                                            <Title text="{i18nGlobal>General.items} ({/length})" />
                                            <ToolbarSpacer />
                                            <Button
                                                tooltip="{i18nGlobal>General.listRefresh}"
                                                icon="sap-icon://refresh"
                                                press="refreshCount" />
                                            <Button
                                                text="{i18n>Action.startCount}"
                                                type="Emphasized"
                                                visible="{
                                                    parts: [ 'lock>/hasLock', '/' ],
                                                    formatter: '.showStartCountFormatter'
                                                }"
                                                press="acquireLock" />
                                            <Button
                                                text="{i18nGlobal>General.save}"
                                                type="Emphasized"
                                                press="onSaveCount"
                                                visible="{= !!${lock>/hasLock} }" />
                                            <Button
                                                text="{i18nGlobal>General.cancel}"
                                                visible="{= !!${lock>/hasLock} }"
                                                press="releaseLock" />
                                        </Toolbar>
                                    </headerToolbar>
                                    <columns>
                                        <Column vAlign="Middle">
                                            <Title
                                                text="{i18nGlobal>General.material}"
                                                tooltip="{i18nGlobal>General.material}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            width="25%"
                                            minScreenWidth="Desktop"
                                            demandPopin="true"
                                            popinDisplay="Inline">
                                            <Title
                                                text="{i18nGlobal>General.description}"
                                                tooltip="{i18nGlobal>General.description}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            width="15%"
                                            minScreenWidth="Desktop"
                                            demandPopin="true"
                                            popinDisplay="Inline">
                                            <Title
                                                text="{i18n>Material.partNumber}"
                                                tooltip="{i18n>Material.partNumber}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            width="15%"
                                            minScreenWidth="Desktop"
                                            demandPopin="true"
                                            popinDisplay="Inline">
                                            <Title
                                                text="{i18n>Material.manufacturer}"
                                                tooltip="{i18n>Material.manufacturer}" />
                                        </Column>
                                        <Column vAlign="Middle">
                                            <Title
                                                text="{i18n>Material.bin}"
                                                tooltip="{i18n>Material.bin}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            hAlign="Right">
                                            <Title
                                                text="{i18nGlobal>General.unit}"
                                                tooltip="{i18nGlobal>General.unit}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            hAlign="Right">
                                            <Title
                                                text="{i18n>Material.quantityCounted}"
                                                tooltip="{i18n>Material.quantityCounted}" />
                                        </Column>
                                    </columns>
                                    <ColumnListItem>
                                        <HBox
                                            fitContainer="true"
                                            renderType="Bare"
                                            alignItems="Center">
                                            <Label
                                                text="{MATNR}"
                                                tooltip="{MATNR}"
                                                design="Bold"
                                                class="identifierTextBlue sapUiTinyMarginEnd" />
                                            <c:Icon
                                                src="sap-icon://message-error"
                                                size="1.25rem"
                                                color="red"
                                                tooltip="{i18nGlobal>General.hasSyncErrors}"
                                                visible="{= !!${EDGE_ERRORS} }"
                                                press="handleResponsivePopoverPress" />
                                        </HBox>
                                        <Label
                                            text="{MAKTX}"
                                            tooltip="{MAKTX}" />
                                        <Label
                                            text="{MFRPN}"
                                            tooltip="{MFRPN}" />
                                        <Label
                                            text="{NAME1}"
                                            tooltip="{NAME1}" />
                                        <Label
                                            text="{LGPBE}"
                                            tooltip="{LGPBE}"
                                            design="Bold" />
                                        <Label
                                            text="{MEINS}"
                                            tooltip="{MEINS}" />
                                        <HBox
                                            fitContainer="true"
                                            renderType="Bare"
                                            justifyContent="End">
                                            <Input
                                                value="{= ${IS_CHANGED} || ${XZAEL} === 'X' ? ${ERFMG} : '' }"
                                                placeholder="0"
                                                textAlign="Right"
                                                editable="{= !!${lock>/hasLock} }"
                                                visible="{= ${XDIFF} !== 'X' }"
                                                change="onCountChange" />
                                            <Label
                                                text="{ERFMG}"
                                                visible="{= ${XDIFF} === 'X' }" />
                                        </HBox>
                                    </ColumnListItem>
                                </Table>
                            </u:blocks>
                        </u:ObjectPageSubSection>
                    </u:subSections>
                </u:ObjectPageSection>
                <u:ObjectPageSection
                    id="review"
                    title="{i18n>Page.review}"
                    visible="{
                        parts: [ 'review>/length', '/', 'review>/' ],
                        formatter: '.showReviewTabFormatter'
                    }">
                    <u:subSections>
                        <u:ObjectPageSubSection>
                            <u:blocks>
                                <Table
                                    noDataText="{i18n>List.empty}"
                                    growing="true"
                                    items="{review>/}"
                                    growingScrollToLoad="true">
                                    <headerToolbar>
                                        <Toolbar>
                                            <Title text="{i18nGlobal>General.items} ({review>/length})" />
                                            <ToolbarSpacer />
                                            <Button
                                                tooltip="{i18nGlobal>General.listRefresh}"
                                                icon="sap-icon://refresh"
                                                press="refreshReview" />
                                            <Button
                                                text="{i18n>Action.startReview}"
                                                type="Emphasized"
                                                visible="{= !${lock>/hasLock} }"
                                                press="acquireLock" />
                                            <Button
                                                text="{i18n>Action.postDifferences}"
                                                type="Emphasized"
                                                press="onSaveReview"
                                                visible="{= !!${lock>/hasLock} }" />
                                            <Button
                                                text="{i18nGlobal>General.cancel}"
                                                visible="{= !!${lock>/hasLock} }"
                                                press="releaseLock" />
                                        </Toolbar>
                                    </headerToolbar>
                                    <columns>
                                        <Column vAlign="Middle">
                                            <Title
                                                text="{i18nGlobal>General.material}"
                                                tooltip="{i18nGlobal>General.material}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            width="25%"
                                            minScreenWidth="Desktop"
                                            demandPopin="true"
                                            popinDisplay="Inline">
                                            <Title
                                                text="{i18nGlobal>General.description}"
                                                tooltip="{i18nGlobal>General.description}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            hAlign="Right">
                                            <Title
                                                text="{i18nGlobal>General.onhand}"
                                                tooltip="{i18nGlobal>General.onhand}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            hAlign="Right">
                                            <Title
                                                text="{i18n>Material.quantityCounted}"
                                                tooltip="{i18n>Material.quantityCounted}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            hAlign="Right">
                                            <Title
                                                text="{i18n>Review.differenceQuantity}"
                                                tooltip="{i18n>Review.differenceQuantity}" />
                                        </Column>
                                        <Column
                                            vAlign="Middle"
                                            minScreenWidth="Tablet"
                                            demandPopin="true"
                                            popinDisplay="Inline">
                                            <Title
                                                text="{i18nGlobal>General.reason}"
                                                tooltip="{i18nGlobal>General.reason}" />
                                        </Column>
                                    </columns>
                                    <ColumnListItem>
                                        <HBox
                                            fitContainer="true"
                                            renderType="Bare"
                                            alignItems="Center">
                                            <Label
                                                text="{review>MATNR}"
                                                tooltip="{review>MATNR}"
                                                design="Bold"
                                                class="identifierTextBlue sapUiTinyMarginEnd" />
                                            <c:Icon
                                                src="sap-icon://message-error"
                                                size="1.25rem"
                                                color="red"
                                                tooltip="{i18nGlobal>General.hasSyncErrors}"
                                                visible="{= !!${review>EDGE_ERRORS} }"
                                                press="handleResponsivePopoverPress" />
                                        </HBox>
                                        <Label
                                            text="{review>MAKTX}"
                                            tooltip="{review>MAKTX}" />
                                        <Label text="{review>BQUAN}" />
                                        <Label text="{review>ERFMG}" />
                                        <Label
                                            text="{review>DIFFCOUNT}"
                                            design="Bold" />
                                        <VBox renderType="Bare">
                                            <Select
                                                items="{
                                                    path: 'reason>/gt',
                                                    templateShareable: false
                                                }"
                                                visible="{= ${review>DIFFCOUNT} > 0 }"
                                                enabled="{= !!${lock>/hasLock} }"
                                                selectedKey="{= ${review>REASON} }"
                                                change="onSelectReason"
                                                forceSelection="false">
                                                <c:Item text="{reason>GRTXT}" key="{reason>GRUND}" />
                                            </Select>
                                            <Select
                                                items="{
                                                    path: 'reason>/lt',
                                                    templateShareable: false
                                                }"
                                                visible="{= ${review>DIFFCOUNT} &lt; 0 }"
                                                enabled="{= !!${lock>/hasLock} }"
                                                selectedKey="{= ${review>REASON} }"
                                                change="onSelectReason"
                                                forceSelection="false">
                                                <c:Item text="{reason>GRTXT}" key="{reason>GRUND}" />
                                            </Select>
                                        </VBox>
                                    </ColumnListItem>
                                </Table>
                            </u:blocks>
                        </u:ObjectPageSubSection>
                    </u:subSections>
                </u:ObjectPageSection>
            </u:sections>
        </u:ObjectPageLayout>
    </Page>
</mvc:View>